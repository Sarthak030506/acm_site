<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Admin Activities List View</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "primary": "#118dd4",
                        "background-light": "#f8fafc", "surface-light": "#ffffff", "surface-highlight": "#f1f5f9", "text-main": "#0f172a", "text-secondary": "#64748b", "border-light": "#e2e8f0",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900 font-display overflow-hidden">
    <!-- Auth Guard protection -->
    <script type="module" src="../assets/js/auth_guard.js"></script>
    <div class="flex h-screen w-full">
        <aside id="sidebar"
            class="fixed inset-y-0 left-0 z-50 w-64 flex flex-col border-r border-border-light bg-surface-light h-full shrink-0 transition-transform duration-300 transform -translate-x-full md:translate-x-0 md:relative md:flex shadow-[4px_0_24px_-12px_rgba(0,0,0,0.1)]">
            <div class="flex h-full flex-col justify-between p-4">
                <div class="flex flex-col gap-6">
                    <div class="flex items-center gap-3 px-2">
                        <div class="bg-center bg-no-repeat bg-cover rounded-full size-10 shadow-md ring-2 ring-primary/20"
                            data-alt="ACM NMIET Logo abstract geometric blue shape"
                            style="background-image: linear-gradient(135deg, #118dd4 0%, #0a4d75 100%);"></div>
                        <div class="flex flex-col">
                            <h1 class="text-slate-900 text-base font-bold leading-normal tracking-wide">ACM NMIET</h1>
                            <p class="text-primary text-xs font-medium leading-normal">Admin Portal</p>
                        </div>
                    </div>
                    <nav class="flex flex-col gap-2">
                        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 transition-colors group"
                            href="../admin_panel_dashboard/code.html">
                            <span
                                class="material-symbols-outlined text-slate-500 group-hover:text-primary transition-colors">dashboard</span>
                            <p
                                class="text-slate-500 group-hover:text-slate-900 text-sm font-medium leading-normal transition-colors">
                                Dashboard Home</p>
                        </a>
                        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 transition-colors group"
                            href="../admin_blog_list_view_page/code.html">
                            <span
                                class="material-symbols-outlined text-slate-500 group-hover:text-primary transition-colors">article</span>
                            <p
                                class="text-slate-500 group-hover:text-slate-900 text-sm font-medium leading-normal transition-colors">
                                Blog Management</p>
                        </a>
                        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 transition-colors group"
                            href="../admin_team_members_list_view_page/code.html">
                            <span
                                class="material-symbols-outlined text-slate-500 group-hover:text-primary transition-colors">group</span>
                            <p
                                class="text-slate-500 group-hover:text-slate-900 text-sm font-medium leading-normal transition-colors">
                                Team Management</p>
                        </a>
                        <a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-primary/10 border-l-4 border-primary shadow-sm"
                            href="../admin_activities_list_view_page/code.html">
                            <span class="material-symbols-outlined text-primary fill-current">event</span>
                            <p class="text-primary text-sm font-bold leading-normal">Activities Management</p>
                        </a>
                        <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 transition-colors group"
                            href="../admin_contact_page_content_editor/code.html">
                            <span
                                class="material-symbols-outlined text-slate-500 group-hover:text-primary transition-colors">contact_page</span>
                            <p
                                class="text-slate-500 group-hover:text-slate-900 text-sm font-medium leading-normal transition-colors">
                                Contact Page Content</p>
                        </a>
                    </nav>
                </div>
                <div class="flex flex-col gap-2 border-t border-slate-200 pt-4">
                    <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-red-50 text-slate-500 hover:text-red-600 transition-colors group"
                        href="../admin_panel_login_screen/code.html">
                        <span class="material-symbols-outlined">logout</span>
                        <p class="text-sm font-medium leading-normal">Log Out</p>
                    </a>
                </div>
            </div>
        </aside>
        <div class="flex-1 flex flex-col min-w-0 h-full relative">
            <header
                class="flex items-center justify-between whitespace-nowrap border-b border-border-light bg-surface-light/80 backdrop-blur-md px-6 py-4 sticky top-0 z-20 shadow-sm">
                <div class="flex items-center gap-4 text-text-main">
                    <button id="mobile-menu-btn" class="md:hidden p-1 text-text-secondary">
                        <span class="material-symbols-outlined">menu</span>
                    </button>
                    <div class="flex flex-col">
                        <div class="flex items-center gap-2 text-text-secondary text-xs">
                            <span>Admin</span>
                            <span class="material-symbols-outlined text-[10px]">chevron_right</span>
                            <span class="text-text-main font-medium">Activities Management</span>
                        </div>
                        <h2 class="text-text-main text-lg font-bold leading-tight tracking-[-0.015em]">Activities</h2>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="hidden sm:flex items-center gap-2">
                        <button
                            class="flex size-9 cursor-pointer items-center justify-center rounded-lg bg-surface-highlight hover:bg-slate-200 text-text-secondary hover:text-text-main transition-colors relative border border-border-light">
                            <span class="material-symbols-outlined text-[20px]">notifications</span>
                            <span
                                class="absolute top-2 right-2 size-2 bg-red-500 rounded-full border border-white"></span>
                        </button>
                        <button
                            class="flex size-9 cursor-pointer items-center justify-center rounded-lg bg-surface-highlight hover:bg-slate-200 text-text-secondary hover:text-text-main transition-colors border border-border-light">
                            <span class="material-symbols-outlined text-[20px]">settings</span>
                        </button>
                    </div>
                    <div class="h-8 w-[1px] bg-border-light mx-2 hidden sm:block"></div>
                    <div class="flex items-center gap-3">
                        <div class="bg-center bg-no-repeat bg-cover rounded-full size-9 border border-border-light shadow-sm"
                            data-alt="User profile picture placeholder gradient"
                            style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuD3SGRhumRt1dMJma6YAdChVPLDBdkpLE-fJn5cEA6E4BMd64UjSn7ZepgBDqDvhj05_JBIFGI2IPTbl5lVlBW6pHKNeQ_0E2CtTIatywfQKzBGEMZ2zCNTrYuXUGDYYRO-Dxjg6HXe9Nf1RrW6_tNKRtw_dCKUuan8PHrO7k4lkpLwLGb4QgIAwZhI_vHizlDrZBUXTamDycwiTrQw756xHw303Ei8im97QWnaylnPjxVUnCSMV5lvzkfaauJapAZt1a9JcBeZocCU");'>
                        </div>
                        <div class="hidden md:flex flex-col">
                            <span class="text-sm font-semibold text-text-main leading-none">Admin User</span>
                            <span class="text-xs text-text-secondary leading-tight mt-1">Super Admin</span>
                        </div>
                        <span
                            class="material-symbols-outlined text-text-secondary text-sm hidden md:block">expand_more</span>
                    </div>
                </div>
            </header>
            <main class="flex-1 overflow-y-auto p-4 lg:p-10">
                <div class="max-w-7xl mx-auto flex flex-col gap-8">
                    <div class="flex flex-col md:flex-row md:items-end justify-between gap-6">
                        <div class="flex flex-col gap-2">
                            <h1 class="text-slate-900 text-3xl lg:text-4xl font-black tracking-tight">Activities
                                Management</h1>
                            <p class="text-slate-500 text-base font-normal max-w-2xl">
                                Manage and view all past, present, and upcoming events. Keep track of schedules and
                                activity statuses.
                            </p>
                        </div>
                        <a href="../admin_activity_editor_page/code.html"
                            class="flex items-center justify-center gap-2 bg-primary hover:bg-primary-dark text-white h-11 px-6 rounded-lg font-bold text-sm transition-all shadow-lg shadow-primary/20 shrink-0">
                            <span class="material-symbols-outlined text-[20px]">add</span>
                            <span>Add New Activity</span>
                        </a>
                    </div>
                    <div
                        class="bg-white border border-slate-200 rounded-xl p-4 flex flex-col md:flex-row gap-4 justify-between items-center shadow-sm">
                        <div class="relative w-full md:max-w-md">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="material-symbols-outlined text-slate-400">search</span>
                            </div>
                            <input
                                class="block w-full pl-10 pr-4 py-2.5 bg-white border border-slate-300 rounded-lg text-slate-900 placeholder-slate-400 focus:border-primary focus:ring-1 focus:ring-primary sm:text-sm transition-all"
                                placeholder="Search by title, keyword or date..." type="text" />
                        </div>
                        <div class="flex gap-3 w-full md:w-auto overflow-x-auto pb-1 md:pb-0">
                            <div class="relative group shrink-0">
                                <button
                                    class="flex items-center justify-between gap-3 w-40 px-3 py-2.5 bg-white hover:bg-slate-50 rounded-lg text-slate-700 text-sm font-medium transition-colors border border-slate-300 hover:border-slate-400">
                                    <span>Category: All</span>
                                    <span
                                        class="material-symbols-outlined text-[20px] text-slate-400">expand_more</span>
                                </button>
                            </div>
                            <div class="relative group shrink-0">
                                <button
                                    class="flex items-center justify-between gap-3 w-40 px-3 py-2.5 bg-white hover:bg-slate-50 rounded-lg text-slate-700 text-sm font-medium transition-colors border border-slate-300 hover:border-slate-400">
                                    <span>Status: All</span>
                                    <span
                                        class="material-symbols-outlined text-[20px] text-slate-400">expand_more</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead>
                                    <tr
                                        class="bg-slate-50 border-b border-slate-200 text-slate-500 text-xs uppercase font-semibold tracking-wider">
                                        <th class="px-6 py-4 rounded-tl-xl">Activity Details</th>
                                        <th class="px-6 py-4">Category</th>
                                        <th class="px-6 py-4">Date</th>
                                        <th class="px-6 py-4">Status</th>
                                        <th class="px-6 py-4 text-right rounded-tr-xl">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-200">
                                    <!-- Dynamic content will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        <div class="bg-white px-6 py-4 border-t border-slate-200 flex items-center justify-between">
                            <p class="text-sm text-slate-500">
                                Showing <span class="font-medium text-slate-900">1</span> to <span
                                    class="font-medium text-slate-900">5</span> of <span
                                    class="font-medium text-slate-900">24</span> results
                            </p>
                            <div class="flex gap-2">
                                <button
                                    class="px-3 py-1.5 rounded-lg border border-slate-300 bg-white text-slate-700 text-sm hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                    disabled="">
                                    Previous
                                </button>
                                <button
                                    class="px-3 py-1.5 rounded-lg border border-slate-300 bg-white text-slate-700 text-sm hover:bg-slate-50 transition-colors">
                                    Next
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

</body>
<script type="module">
    import { db } from '../assets/js/firebase_config.js';
    import { collection, getDocs, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    document.addEventListener('DOMContentLoaded', async function () {
        const menuBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.getElementById('sidebar');

        if (menuBtn && sidebar) {
            menuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
            });
        }

        // --- DYNAMIC DATA LOADING ---
        const tableBody = document.querySelector('tbody');

        async function loadActivities() {
            tableBody.innerHTML = '<tr><td colspan="5" class="px-6 py-10 text-center"><span class="material-symbols-outlined animate-spin text-4xl text-primary">progress_activity</span></td></tr>';

            try {
                const q = query(collection(db, "activities"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);

                tableBody.innerHTML = '';

                if (querySnapshot.empty) {
                    tableBody.innerHTML = '<tr><td colspan="5" class="px-6 py-10 text-center text-slate-500">No activities found. Click "Add New Activity" to create one.</td></tr>';
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const activity = doc.data();
                    const row = createActivityRow(doc.id, activity);
                    tableBody.appendChild(row);
                });

                // Update counts (simple version)
                const countSpan = document.querySelector('.text-slate-500 span.font-medium:last-child');
                if (countSpan) countSpan.textContent = querySnapshot.size;

            } catch (error) {
                console.error("Error fetching activities:", error);
                tableBody.innerHTML = `<tr><td colspan="5" class="px-6 py-10 text-center text-red-500">Error loading activities: ${error.message}</td></tr>`;
            }
        }

        function createActivityRow(id, activity) {
            const tr = document.createElement('tr');
            tr.className = "group hover:bg-slate-50 transition-colors";

            // Status Styling
            let statusBadge = '';
            if (activity.status === 'upcoming') {
                statusBadge = `<span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-blue-50 text-blue-700 text-xs font-bold border border-blue-200"><span class="size-1.5 rounded-full bg-blue-500"></span>Upcoming</span>`;
            } else if (activity.status === 'ongoing') {
                statusBadge = `<span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-green-50 text-green-700 text-xs font-bold border border-green-200"><span class="size-1.5 rounded-full bg-green-500"></span>Ongoing</span>`;
            } else if (activity.status === 'completed') {
                statusBadge = `<span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-gray-100 text-gray-600 text-xs font-bold border border-gray-200"><span class="size-1.5 rounded-full bg-gray-500"></span>Completed</span>`;
            } else {
                statusBadge = `<span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-gray-100 text-gray-600 text-xs font-bold border border-gray-200"><span class="size-1.5 rounded-full bg-gray-500"></span>${activity.status || 'N/A'}</span>`;
            }

            tr.innerHTML = `
                <td class="px-6 py-4 max-w-sm">
                    <div class="flex flex-col gap-1">
                        <span class="text-slate-900 font-semibold text-base">${activity.title}</span>
                        <span class="text-slate-500 text-sm truncate">${activity.description || ''}</span>
                    </div>
                </td>
                <td class="px-6 py-4">
                    <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-slate-100 text-slate-700 text-xs font-medium border border-slate-200 capitalize">${activity.activityType}</span>
                </td>
                <td class="px-6 py-4">
                    <div class="flex items-center gap-2 text-sm text-slate-500">
                        <span class="material-symbols-outlined text-[16px]">calendar_today</span>
                        <span>${activity.date}</span>
                    </div>
                </td>
                <td class="px-6 py-4">
                    ${statusBadge}
                </td>
                <td class="px-6 py-4 text-right">
                    <div class="flex items-center justify-end gap-2">
                        <button onclick="window.location.href='../admin_activity_editor_page/code.html?id=${id}'" class="size-8 flex items-center justify-center rounded-lg text-slate-400 hover:bg-blue-50 hover:text-blue-600 transition-all" title="Edit">
                            <span class="material-symbols-outlined text-[18px]">edit</span>
                        </button>
                        <button class="delete-btn size-8 flex items-center justify-center rounded-lg text-slate-400 hover:bg-red-50 hover:text-red-600 transition-all" 
                            data-id="${id}" title="Delete">
                            <span class="material-symbols-outlined text-[18px]">delete</span>
                        </button>
                    </div>
                </td>
            `;

            // Add delete event listener
            const deleteBtn = tr.querySelector('.delete-btn');
            deleteBtn.addEventListener('click', async () => {
                if (confirm(`Are you sure you want to delete "${activity.title}"?`)) {
                    try {
                        await deleteDoc(doc(db, "activities", id));
                        tr.remove();
                        alert("Activity deleted.");
                    } catch (err) {
                        alert("Error deleting: " + err.message);
                    }
                }
            });

            return tr;
        }

        loadActivities();
    });
</script>

</html>