<!DOCTYPE html>
<html class="light" lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Admin Team Member Editor - ACM NMIET</title>
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script id="tailwind-config">
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            "primary": "#118dd4",
            "background-light": "#f8fafc", "surface-light": "#ffffff", "card-light": "#ffffff", "surface-highlight": "#f1f5f9", "text-main": "#0f172a", "text-secondary": "#64748b", "text-muted": "#64748b", "border-light": "#e2e8f0",
          },
          fontFamily: {
            "display": ["Inter", "sans-serif"]
          },
          borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
        },
      },
    }
  </script>
  <style>
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f5f9;
    }

    ::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }

    .material-symbols-outlined {
      font-variation-settings:
        'FILL' 0,
        'wght' 400,
        'GRAD' 0,
        'opsz' 24
    }

    .material-symbols-outlined.fill {
      font-variation-settings:
        'FILL' 1,
        'wght' 400,
        'GRAD' 0,
        'opsz' 24
    }
  </style>
</head>

<body class="bg-background-light text-text-main font-display overflow-x-hidden antialiased">
  <!-- Auth Guard protection -->
  <script type="module" src="../assets/js/auth_guard.js"></script>

  <div class="relative flex min-h-screen w-full flex-col lg:flex-row">
    <aside id="sidebar"
      class="fixed inset-y-0 left-0 z-50 w-64 flex flex-col border-r border-border-light bg-surface-light h-full shrink-0 transition-transform duration-300 transform -translate-x-full md:translate-x-0 md:relative md:flex shadow-[4px_0_24px_-12px_rgba(0,0,0,0.1)]">
      <div class="flex h-full flex-col justify-between p-4">
        <div class="flex flex-col gap-6">
          <div class="flex items-center gap-3 px-2">
            <div class="bg-center bg-no-repeat bg-cover rounded-full size-10 shadow-md ring-2 ring-primary/20"
              data-alt="ACM NMIET Logo abstract geometric blue shape"
              style="background-image: linear-gradient(135deg, #118dd4 0%, #0a4d75 100%);"></div>
            <div class="flex flex-col">
              <h1 class="text-text-main text-base font-bold leading-normal tracking-wide">ACM NMIET</h1>
              <p class="text-primary text-xs font-medium leading-normal">Admin Portal</p>
            </div>
          </div>
          <nav class="flex flex-col gap-2">
            <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 transition-colors group"
              href="../admin_panel_dashboard/code.html">
              <span
                class="material-symbols-outlined text-text-muted group-hover:text-primary transition-colors">dashboard</span>
              <p
                class="text-text-muted group-hover:text-text-main text-sm font-medium leading-normal transition-colors">
                Dashboard Home</p>
            </a>
            <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 transition-colors group"
              href="../admin_blog_list_view_page/code.html">
              <span
                class="material-symbols-outlined text-text-muted group-hover:text-primary transition-colors">article</span>
              <p
                class="text-text-muted group-hover:text-text-main text-sm font-medium leading-normal transition-colors">
                Blog Management</p>
            </a>
            <a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-primary/10 border-l-4 border-primary shadow-sm"
              href="../admin_team_members_list_view_page/code.html">
              <span class="material-symbols-outlined text-primary fill-current">group</span>
              <p class="text-primary text-sm font-bold leading-normal">Team Management</p>
            </a>
            <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 transition-colors group"
              href="../admin_activities_list_view_page/code.html">
              <span
                class="material-symbols-outlined text-text-muted group-hover:text-primary transition-colors">event</span>
              <p
                class="text-text-muted group-hover:text-text-main text-sm font-medium leading-normal transition-colors">
                Activities Management</p>
            </a>
            <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 transition-colors group"
              href="../admin_contact_page_content_editor/code.html">
              <span
                class="material-symbols-outlined text-text-muted group-hover:text-primary transition-colors">contact_page</span>
              <p
                class="text-text-muted group-hover:text-text-main text-sm font-medium leading-normal transition-colors">
                Contact Page Content</p>
            </a>
          </nav>
        </div>
        <div class="flex flex-col gap-2 border-t border-border-light pt-4">
          <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-red-50 text-text-muted hover:text-red-600 transition-colors group"
            href="../admin_panel_login_screen/code.html">
            <span class="material-symbols-outlined">logout</span>
            <p class="text-sm font-medium leading-normal">Log Out</p>
          </a>
        </div>
      </div>
    </aside>
    <main class="flex-1 flex flex-col h-full min-h-screen overflow-y-auto bg-gray-50/50">
      <header
        class="flex items-center justify-between whitespace-nowrap border-b border-border-light bg-surface-light/80 backdrop-blur-md px-6 py-4 sticky top-0 z-20 shadow-sm">
        <div class="flex items-center gap-4 text-text-main">
          <button id="mobile-menu-btn" class="md:hidden p-1 text-text-secondary">
            <span class="material-symbols-outlined">menu</span>
          </button>
          <div class="flex flex-col">
            <div class="flex items-center gap-2 text-text-secondary text-xs">
              <span>Admin</span>
              <span class="material-symbols-outlined text-[10px]">chevron_right</span>
              <span class="text-text-main font-medium">Team Management</span>
            </div>
            <h2 class="text-text-main text-lg font-bold leading-tight tracking-[-0.015em]">Edit Team Member</h2>
          </div>
        </div>
        <div class="flex items-center gap-4">
          <div class="hidden sm:flex items-center gap-2">
            <button
              class="flex size-9 cursor-pointer items-center justify-center rounded-lg bg-white hover:bg-slate-200 text-text-secondary hover:text-text-main transition-colors relative border border-border-light">
              <span class="material-symbols-outlined text-[20px]">notifications</span>
              <span class="absolute top-2 right-2 size-2 bg-red-500 rounded-full border border-white"></span>
            </button>
            <button
              class="flex size-9 cursor-pointer items-center justify-center rounded-lg bg-white hover:bg-slate-200 text-text-secondary hover:text-text-main transition-colors border border-border-light">
              <span class="material-symbols-outlined text-[20px]">settings</span>
            </button>
          </div>
          <div class="h-8 w-[1px] bg-border-light mx-2 hidden sm:block"></div>
          <div class="flex items-center gap-3">
            <div class="bg-center bg-no-repeat bg-cover rounded-full size-9 border border-border-light shadow-sm"
              data-alt="User profile picture placeholder gradient"
              style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuD3SGRhumRt1dMJma6YAdChVPLDBdkpLE-fJn5cEA6E4BMd64UjSn7ZepgBDqDvhj05_JBIFGI2IPTbl5lVlBW6pHKNeQ_0E2CtTIatywfQKzBGEMZ2zCNTrYuXUGDYYRO-Dxjg6HXe9Nf1RrW6_tNKRtw_dCKUuan8PHrO7k4lkpLwLGb4QgIAwZhI_vHizlDrZBUXTamDycwiTrQw756xHw303Ei8im97QWnaylnPjxVUnCSMV5lvzkfaauJapAZt1a9JcBeZocCU");'>
            </div>
            <div class="hidden md:flex flex-col">
              <span class="text-sm font-semibold text-text-main leading-none">Admin User</span>
              <span class="text-xs text-text-secondary leading-tight mt-1">Super Admin</span>
            </div>
            <span class="material-symbols-outlined text-text-secondary text-sm hidden md:block">expand_more</span>
          </div>
        </div>
      </header>
      <div class="flex-1 max-w-[1200px] w-full mx-auto p-4 md:p-8 lg:p-12">
        <div class="flex flex-wrap gap-2 mb-6 items-center">
          <a class="text-text-muted text-sm font-medium hover:text-primary transition-colors"
            href="../admin_panel_dashboard/code.html">Dashboard</a>
          <span class="material-symbols-outlined text-gray-400 text-sm">chevron_right</span>
          <a class="text-text-muted text-sm font-medium hover:text-primary transition-colors"
            href="../admin_team_members_list_view_page/code.html">Team Members</a>
          <span class="material-symbols-outlined text-gray-400 text-sm">chevron_right</span>
          <span class="text-text-main text-sm font-medium">Edit Member</span>
        </div>
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4 mb-8">
          <div class="flex flex-col gap-2">
            <h1 class="text-text-main text-3xl md:text-4xl font-black tracking-[-0.033em]">Edit Team Member</h1>
            <p class="text-text-muted text-base font-normal max-w-2xl">Update member details, assign roles, and manage
              public profile links.</p>
          </div>
          <div class="flex gap-3">
            <button
              class="flex items-center gap-2 text-red-600 hover:text-red-700 hover:bg-red-50 font-medium text-sm transition-colors px-3 py-2 rounded-lg border border-transparent hover:border-red-100">
              <span class="material-symbols-outlined text-lg">delete</span>
              Delete Member
            </button>
          </div>
        </div>
        <div class="bg-card-light border border-border-light rounded-xl shadow-sm overflow-hidden">
          <div class="p-6 md:p-8">
            <form class="flex flex-col lg:flex-row gap-8 lg:gap-12">
              <div
                class="lg:w-1/3 flex flex-col gap-6 items-center border-b lg:border-b-0 lg:border-r border-border-light pb-8 lg:pb-0 lg:pr-8">
                <div class="flex flex-col gap-2 w-full">
                  <h3 class="text-text-main text-lg font-bold">Profile Photo</h3>
                  <p class="text-text-muted text-sm">Upload a high-res image. Face should be clearly visible. Cropped to
                    circle.</p>
                </div>
                <div class="relative group cursor-pointer w-48 h-48">
                  <div
                    class="w-full h-full rounded-full border-4 border-gray-100 overflow-hidden bg-gray-50 relative shadow-sm">
                    <div
                      class="w-full h-full bg-center bg-no-repeat bg-cover transition-transform group-hover:scale-105 duration-500"
                      data-alt="Current profile photo of the team member showing a professional headshot"
                      style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAYLSoKvpwJq5m4tYMt7dNJ1cCpfmxOzFlFY7ajxUJS6jWfngdWnTM41-xIJAjx0EvRyO_q4uHj3D1uoXXeGgNMWr6EZzjp3CV_HAYJ2_SQmsHk4vSUhWgwe8dYvOler5gltF-TddfzzPLmu1Y_BGeFRmsS9I9yA2bHE9BCrCbW6Pddj_-5PgbMXAlUqC_KfS7JhzRr7L8j01Zp29m0BiHmQuktltnjSQLU9pTv4KW4DuGKC");'>
                    </div>
                    <div
                      class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center backdrop-blur-[1px]">
                      <span class="material-symbols-outlined text-white text-4xl drop-shadow-md">edit</span>
                    </div>
                  </div>
                  <div
                    class="absolute bottom-2 right-2 bg-white rounded-full p-2 border border-gray-200 text-primary shadow-md">
                    <span class="material-symbols-outlined text-sm">photo_camera</span>
                  </div>
                </div>
                <div class="w-full flex flex-col gap-3 items-center">
                  <div class="w-full flex flex-col gap-3 items-center">
                    <div class="w-full">
                      <label class="text-text-muted text-xs font-semibold uppercase tracking-wider mb-1 block"
                        for="photoUrl">Photo URL</label>
                      <input
                        class="w-full bg-white text-text-main border border-gray-300 rounded-lg px-4 py-2.5 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all placeholder:text-gray-400 shadow-sm text-sm"
                        id="photoUrl" placeholder="https://example.com/photo.jpg" type="url" />
                    </div>
                    <p class="text-text-muted text-xs text-center">Paste a public link to the profile photo.<br />We
                      recommend a square image.</p>
                  </div>
                </div>
              </div>
              <div class="flex-1 flex flex-col gap-8">
                <div class="flex flex-col gap-5">
                  <h3 class="text-text-main text-lg font-bold border-b border-border-light pb-2">Personal Information
                  </h3>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div class="flex flex-col gap-2">
                      <label class="text-text-muted text-xs font-semibold uppercase tracking-wider" for="fullName">Full
                        Name</label>
                      <input
                        class="w-full bg-white text-text-main border border-gray-300 rounded-lg px-4 py-2.5 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all placeholder:text-gray-400 shadow-sm"
                        id="fullName" placeholder="e.g. John Doe" type="text" value="Alex Morgan" />
                    </div>
                    <div class="flex flex-col gap-2">
                      <label class="text-text-muted text-xs font-semibold uppercase tracking-wider" for="role">Role /
                        Position</label>
                      <div class="relative">
                        <select
                          class="w-full bg-white text-text-main border border-gray-300 rounded-lg px-4 py-2.5 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all appearance-none cursor-pointer shadow-sm"
                          id="role">
                          <option value="">Select a role...</option>
                          <optgroup label="Faculty">
                            <option value="Faculty Sponsor">Faculty Sponsor</option>
                            <option value="Faculty Coordinator">Faculty Coordinator</option>
                          </optgroup>
                          <optgroup label="Core Team">
                            <option value="President">President</option>
                            <option value="Vice President">Vice President</option>
                            <option value="Secretary">Secretary</option>
                            <option value="Co-Secretary">Co-Secretary</option>
                            <option value="Treasurer">Treasurer</option>
                            <option value="Co-Treasurer">Co-Treasurer</option>
                            <option value="Management Head">Management Head</option>
                          </optgroup>
                          <optgroup label="Executive Members">
                            <option value="Executive Member">Executive Member</option>
                            <option value="Executive Member (President ACES)">Executive Member (President ACES)</option>
                            <option value="Executive Member (Vice President ACES)">Executive Member (Vice President ACES)</option>
                          </optgroup>
                          <optgroup label="Technical">
                            <option value="Technical Head">Technical Head</option>
                            <option value="Web Master">Web Master</option>
                          </optgroup>
                          <optgroup label="Design & Media">
                            <option value="Design Head">Design Head</option>
                            <option value="Design Coordinator">Design Coordinator</option>
                            <option value="Design Team">Design Team</option>
                            <option value="Social Media Head">Social Media Head</option>
                            <option value="Visual Media">Visual Media</option>
                            <option value="Media/ Marketing Team">Media/ Marketing Team</option>
                          </optgroup>
                          <optgroup label="Members">
                            <option value="ACM Student Member">ACM Student Member</option>
                          </optgroup>
                        </select>
                        <div
                          class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-gray-500">
                          <span class="material-symbols-outlined">expand_more</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="flex flex-col gap-5">
                  <h3 class="text-text-main text-lg font-bold border-b border-border-light pb-2">Academic Details</h3>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div class="flex flex-col gap-2">
                      <label class="text-text-muted text-xs font-semibold uppercase tracking-wider"
                        for="designation">Designation <span class="text-gray-400 normal-case font-normal">(Faculty
                          only)</span></label>
                      <input
                        class="w-full bg-white text-text-main border border-gray-300 rounded-lg px-4 py-2.5 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all placeholder:text-gray-400 shadow-sm"
                        id="designation" placeholder="e.g. Assistant Professor" type="text" />
                    </div>
                    <div class="flex flex-col gap-2">
                      <label class="text-text-muted text-xs font-semibold uppercase tracking-wider"
                        for="department">Department</label>
                      <input
                        class="w-full bg-white text-text-main border border-gray-300 rounded-lg px-4 py-2.5 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all placeholder:text-gray-400 shadow-sm"
                        id="department" placeholder="e.g. Computer Engineering" type="text"
                        value="Computer Engineering" />
                    </div>
                  </div>
                </div>
                <div class="flex flex-col gap-5">
                  <h3 class="text-text-main text-lg font-bold border-b border-border-light pb-2">Social Profiles</h3>
                  <div class="grid grid-cols-1 gap-5">
                    <div class="flex flex-col gap-2">
                      <label class="text-text-muted text-xs font-semibold uppercase tracking-wider"
                        for="linkedin">LinkedIn URL</label>
                      <div class="relative flex items-center">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                          <span class="material-symbols-outlined text-gray-400">link</span>
                        </div>
                        <input
                          class="w-full bg-white text-text-main border border-gray-300 rounded-lg pl-10 pr-4 py-2.5 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all placeholder:text-gray-400 shadow-sm"
                          id="linkedin" placeholder="https://linkedin.com/in/username" type="url" />
                      </div>
                    </div>
                    <div class="flex flex-col gap-2">
                      <label class="text-text-muted text-xs font-semibold uppercase tracking-wider" for="instagram">Instagram
                        URL</label>
                      <div class="relative flex items-center">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                          <span class="material-symbols-outlined text-gray-400">photo_camera</span>
                        </div>
                        <input
                          class="w-full bg-white text-text-main border border-gray-300 rounded-lg pl-10 pr-4 py-2.5 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all placeholder:text-gray-400 shadow-sm"
                          id="instagram" placeholder="https://instagram.com/username" type="url" />
                      </div>
                    </div>
                  </div>
                </div>
                <div class="flex items-center justify-end gap-4 pt-4 mt-4 border-t border-border-light">
                  <a href="../admin_team_members_list_view_page/code.html"
                    class="px-6 py-2.5 rounded-lg text-text-muted font-medium text-sm hover:bg-gray-100 hover:text-text-main transition-colors border border-transparent hover:border-gray-200">
                    Cancel
                  </a>
                  <button
                    class="flex items-center gap-2 px-6 py-2.5 rounded-lg bg-primary hover:bg-primary-hover text-white font-bold text-sm transition-all shadow-md shadow-primary/20 hover:shadow-lg hover:shadow-primary/30"
                    type="submit">
                    <span class="material-symbols-outlined text-lg">save</span>
                    Save Member
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </main>
  </div>
</body>
<script type="module">
  import { db } from '../assets/js/firebase_config.js';
  import { collection, addDoc, doc, getDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // --- GET FORM ELEMENTS ---
  const roleSelect = document.getElementById('role');
  const submitBtn = document.querySelector('button[type="submit"]');
  const photoUrlInput = document.getElementById('photoUrl');
  const previewImage = document.querySelector('[data-alt="Current profile photo of the team member showing a professional headshot"]');
  const fullNameInput = document.getElementById('fullName');
  const designationInput = document.getElementById('designation');
  const departmentInput = document.getElementById('department');
  const linkedinInput = document.getElementById('linkedin');
  const instagramInput = document.getElementById('instagram');
  const pageTitle = document.querySelector('h1');
  const pageDescription = document.querySelector('h1 + p');
  const deleteBtn = document.querySelector('.text-red-600');

  // --- CHECK FOR EDIT MODE ---
  const urlParams = new URLSearchParams(window.location.search);
  const memberId = urlParams.get('id');
  const isEditMode = memberId && memberId.length > 0;

  // Store original createdAt for edit mode
  let originalCreatedAt = null;

  // --- CLEAR ALL FORM FIELDS ---
  function clearForm() {
    fullNameInput.value = '';
    roleSelect.value = '';
    designationInput.value = '';
    departmentInput.value = '';
    linkedinInput.value = '';
    instagramInput.value = '';
    photoUrlInput.value = '';
  }

  // --- LOAD MEMBER DATA ---
  async function loadMemberData() {
    if (!isEditMode) return null;

    try {
      const memberRef = doc(db, "team_members", memberId);
      const memberDoc = await getDoc(memberRef);

      if (!memberDoc.exists()) {
        alert('Member not found!');
        window.location.href = '../admin_team_members_list_view_page/code.html';
        return null;
      }

      return memberDoc.data();

    } catch (error) {
      console.error("Error loading member:", error);
      alert('Error loading member: ' + error.message);
      return null;
    }
  }

  // --- POPULATE FORM WITH MEMBER DATA ---
  function populateForm(member) {
    if (!member) return;

    fullNameInput.value = member.name || '';
    roleSelect.value = member.role || '';
    designationInput.value = member.position || '';
    departmentInput.value = member.department || '';
    linkedinInput.value = member.linkedin || '';
    instagramInput.value = member.instagram || '';
    photoUrlInput.value = member.photoURL || '';

    originalCreatedAt = member.createdAt;

    if (member.photoURL) {
      previewImage.style.backgroundImage = `url("${member.photoURL}")`;
    }
  }

  // --- INITIALIZE PAGE ---
  async function initPage() {
    // Mobile menu
    const menuBtn = document.getElementById('mobile-menu-btn');
    const sidebar = document.getElementById('sidebar');
    if (menuBtn && sidebar) {
      menuBtn.addEventListener('click', () => {
        sidebar.classList.toggle('-translate-x-full');
      });
    }

    // Clear form first
    clearForm();

    if (isEditMode) {
      // EDIT MODE
      if (pageTitle) pageTitle.textContent = 'Edit Team Member';
      if (submitBtn) submitBtn.innerHTML = '<span class="material-symbols-outlined text-lg">save</span> Update Member';

      // Load and populate member data
      const member = await loadMemberData();
      if (member) {
        populateForm(member);
      }

    } else {
      // ADD MODE
      if (pageTitle) pageTitle.textContent = 'Add New Team Member';
      if (pageDescription) pageDescription.textContent = 'Fill in the details to add a new team member to your organization.';
      if (deleteBtn) deleteBtn.style.display = 'none';
    }

    // --- LIVE PREVIEW FOR PHOTO ---
    photoUrlInput.addEventListener('input', (e) => {
      const url = e.target.value;
      if (url && url.length > 10) {
        previewImage.style.backgroundImage = `url("${url}")`;
      }
    });

    // --- DELETE MEMBER ---
    if (deleteBtn && isEditMode) {
      deleteBtn.addEventListener('click', async () => {
        if (!confirm('Are you sure you want to delete this team member? This action cannot be undone.')) {
          return;
        }

        try {
          await deleteDoc(doc(db, "team_members", memberId));
          alert('Team member deleted successfully!');
          window.location.href = '../admin_team_members_list_view_page/code.html';
        } catch (error) {
          console.error("Error deleting member:", error);
          alert('Error deleting member: ' + error.message);
        }
      });
    }

    // --- SAVE/UPDATE MEMBER ---
    submitBtn.addEventListener('click', async (e) => {
      e.preventDefault();

      const originalText = submitBtn.innerHTML;
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="material-symbols-outlined animate-spin">refresh</span> Saving...';

      const fullName = fullNameInput.value.trim();
      const role = roleSelect.value;
      const designation = designationInput.value.trim();
      const department = departmentInput.value.trim();
      const linkedin = linkedinInput.value.trim();
      const instagram = instagramInput.value.trim();
      const photoUrl = photoUrlInput.value.trim() || "";

      if (!fullName || !role) {
        alert("Please fill in at least Name and Role.");
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
        return;
      }

      try {
        const memberData = {
          name: fullName,
          role: role,
          position: designation || role,
          department: department,
          linkedin: linkedin,
          instagram: instagram,
          photoURL: photoUrl,
          updatedAt: new Date()
        };

        if (isEditMode && memberId) {
          memberData.createdAt = originalCreatedAt || new Date();
          await updateDoc(doc(db, "team_members", memberId), memberData);
          alert("Team member updated successfully!");
        } else {
          memberData.createdAt = new Date();
          await addDoc(collection(db, "team_members"), memberData);
          alert("Team member added successfully!");
        }

        window.location.href = "../admin_team_members_list_view_page/code.html";

      } catch (error) {
        console.error("Error saving document: ", error);
        alert("Error saving: " + error.message);
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
      }
    });
  }

  // Start initialization
  initPage();
</script>

</html>